<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IA Geradora de Scripts - Groq API</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #121212; 
            color: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }
        
        .chat-container { 
            max-width: 800px; 
            margin: 40px auto; 
            border: 1px solid #333; 
            padding: 25px; 
            border-radius: 12px; 
            background: #1e1e1e;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }
        
        h2 {
            color: #4fc3f7;
            margin-bottom: 15px;
            text-align: center;
            font-size: 28px;
        }
        
        .subtitle {
            text-align: center;
            color: #aaa;
            margin-bottom: 25px;
            font-size: 14px;
        }
        
        .messages { 
            height: 400px; 
            overflow-y: auto; 
            border: 1px solid #444; 
            padding: 15px; 
            margin-bottom: 20px; 
            background: #000; 
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }
        
        .messages::-webkit-scrollbar {
            width: 8px;
        }
        
        .messages::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        .messages::-webkit-scrollbar-thumb {
            background: #4caf50;
            border-radius: 4px;
        }
        
        .msg { 
            margin-bottom: 15px; 
            padding-bottom: 15px;
            border-bottom: 1px solid #2a2a2a;
        }
        
        .msg:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .user { 
            color: #4fc3f7; 
        }
        
        .ai { 
            color: #a5d6a7; 
            white-space: pre-wrap;
        }
        
        .input-area { 
            display: flex; 
            gap: 12px;
            align-items: flex-end;
        }
        
        textarea { 
            flex: 1; 
            min-height: 80px;
            max-height: 200px;
            resize: vertical; 
            padding: 12px;
            background: #252525;
            border: 1px solid #444;
            border-radius: 6px;
            color: #fff;
            font-family: inherit;
            font-size: 14px;
        }
        
        textarea:focus {
            outline: none;
            border-color: #4fc3f7;
        }
        
        textarea::placeholder {
            color: #888;
        }
        
        button { 
            padding: 12px 20px; 
            cursor: pointer; 
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: #fff; 
            border: none; 
            border-radius: 6px;
            font-weight: bold;
            transition: all 0.3s ease;
            height: 44px;
        }
        
        button:hover:not(:disabled) {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
        }
        
        button:active:not(:disabled) {
            transform: translateY(0);
        }
        
        button:disabled { 
            background: #555; 
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .message-label {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .user .message-label {
            color: #4fc3f7;
        }
        
        .ai .message-label {
            color: #81c784;
        }
        
        .config-panel {
            background: #252525;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }
        
        .config-panel h3 {
            color: #4fc3f7;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .config-item {
            margin-bottom: 10px;
        }
        
        .config-item label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
            font-size: 14px;
        }
        
        .config-item input {
            width: 100%;
            padding: 8px;
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 4px;
            color: #fff;
        }
        
        .warning {
            background: #4a3428;
            border: 1px solid #ff9800;
            color: #ffcc80;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 14px;
        }
        
        .model-info {
            background: #2a3a4a;
            border: 1px solid #4fc3f7;
            color: #b3e5fc;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 14px;
        }
        
        pre.code-block {
            background: #0d1117;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 10px 0;
            border: 1px solid #30363d;
        }
        
        pre.code-block code {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            color: #c9d1d9;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .thinking {
            color: #ffb74d !important;
            font-style: italic;
        }
        
        @media (max-width: 600px) {
            .chat-container {
                margin: 20px auto;
                padding: 15px;
            }
            
            .messages {
                height: 300px;
            }
            
            .input-area {
                flex-direction: column;
            }
            
            textarea {
                width: 100%;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <h2>ü§ñ IA Geradora de Scripts - Groq API</h2>
        <p class="subtitle">Usando Groq com modelo Qwen 32B para gerar scripts de programa√ß√£o</p>
        
        <div class="config-panel">
            <h3>Configura√ß√£o da API Groq</h3>
            <div class="config-item">
                <label for="apiKey">Chave da API Groq:</label>
                <input type="password" id="apiKey" placeholder="Cole sua chave gsk_... aqui">
            </div>
            <div class="config-item">
                <label for="modelSelect">Modelo:</label>
                <select id="modelSelect">
                    <option value="qwen/qwen3-32b">Qwen 3 32B (Recomendado)</option>
                    <option value="llama-3.1-8b-instant">Llama 3.1 8B Instant</option>
                    <option value="llama-3.3-70b-versatile">Llama 3.3 70B Versatile</option>
                    <option value="llama-3.2-3b-preview">Llama 3.2 3B Preview</option>
                    <option value="llama-3.2-1b-preview">Llama 3.2 1B Preview</option>
                    <option value="llama-3.2-90b-vision-preview">Llama 3.2 90B Vision</option>
                    <option value="llama-guard-3-8b">Llama Guard 3 8B</option>
                    <option value="gemma2-9b-it">Gemma2 9B</option>
                </select>
            </div>
            <div class="model-info">
                ‚úÖ Usando: <strong>qwen/qwen3-32b</strong><br>
                ‚ö° R√°pido e poderoso para gera√ß√£o de c√≥digo<br>
                üÜì Gratuito no plano inicial do Groq
            </div>
            <div class="warning">
                üîë Obtenha sua chave gratuita em: <a href="https://console.groq.com" target="_blank" style="color:#ffcc80;">console.groq.com</a><br>
                ‚ö†Ô∏è A chave fica apenas no seu navegador
            </div>
        </div>
        
        <div class="messages" id="messages">
            <div class="msg ai">
                <div class="message-label">IA:</div>
                Ol√°! Sou uma IA especializada em gerar scripts de programa√ß√£o usando a API Groq. 
                Me diga o que voc√™ precisa (ex: "Crie um script Python que leia um arquivo CSV" 
                ou "JavaScript para valida√ß√£o de formul√°rio") e eu vou gerar o c√≥digo para voc√™.
                
                Insira sua chave Groq (gsk_...) acima para come√ßar.
            </div>
        </div>
        
        <div class="input-area">
            <textarea id="userInput" placeholder="Exemplo: Crie um script JavaScript que valide um formul√°rio de login..."></textarea>
            <button id="sendBtn">Gerar Script</button>
        </div>
    </div>

    <script>
        // Elementos DOM
        const messagesDiv = document.getElementById("messages");
        const userInput = document.getElementById("userInput");
        const sendBtn = document.getElementById("sendBtn");
        const apiKeyInput = document.getElementById("apiKey");
        const modelSelect = document.getElementById("modelSelect");

        // URL da API Groq (compat√≠vel com OpenAI)
        const API_URL = "https://api.groq.com/openai/v1/chat/completions";

        // Carregar configura√ß√£o salva
        function loadConfig() {
            try {
                const savedApiKey = localStorage.getItem('groq_api_key') || '';
                const savedModel = localStorage.getItem('groq_model') || 'qwen/qwen3-32b';
                
                apiKeyInput.value = savedApiKey;
                modelSelect.value = savedModel;
                
                updateUI();
            } catch (e) {
                console.error("Erro ao carregar configura√ß√£o:", e);
            }
        }

        // Salvar configura√ß√£o
        function saveConfig() {
            try {
                localStorage.setItem('groq_api_key', apiKeyInput.value);
                localStorage.setItem('groq_model', modelSelect.value);
            } catch (e) {
                console.error("Erro ao salvar configura√ß√£o:", e);
            }
        }

        // Atualizar UI
        function updateUI() {
            const hasApiKey = apiKeyInput.value.trim().length > 0;
            
            sendBtn.disabled = !hasApiKey;
            sendBtn.textContent = "Gerar Script";
            
            // Atualizar info do modelo
            const modelInfo = document.querySelector('.model-info');
            if (modelInfo) {
                const modelName = modelSelect.options[modelSelect.selectedIndex].text;
                modelInfo.innerHTML = `‚úÖ Usando: <strong>${modelSelect.value}</strong><br>
                                     üìù ${modelName}<br>
                                     ‚ö° Otimizado para velocidade`;
            }
        }

        // Adicionar mensagem ao chat
        function addMessage(text, sender, isStreaming = false) {
            // Se for streaming e j√° houver mensagem da IA, atualize-a
            if (isStreaming && sender === "ai") {
                const lastMsg = messagesDiv.querySelector('.msg.ai:last-child');
                if (lastMsg && lastMsg.querySelector('.streaming-content')) {
                    const contentDiv = lastMsg.querySelector('.streaming-content');
                    contentDiv.textContent = text;
                    messagesDiv.scrollTop = messagesDiv.scrollHeight;
                    return lastMsg;
                }
            }
            
            const div = document.createElement("div");
            div.className = "msg " + sender;
            
            const label = document.createElement("div");
            label.className = "message-label";
            label.textContent = sender === "user" ? "Voc√™" : "IA";
            
            const content = document.createElement("div");
            if (isStreaming && sender === "ai") {
                content.className = "streaming-content";
            }
            content.textContent = text;
            
            div.appendChild(label);
            div.appendChild(content);
            messagesDiv.appendChild(div);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            return div;
        }

        // Processar blocos de c√≥digo na resposta
        function processCodeBlocks(element) {
            const text = element.textContent;
            
            // Procurar blocos de c√≥digo markdown
            const codeBlockRegex = /```(\w+)?\n?([\s\S]*?)```/g;
            let match;
            let newContent = text;
            const codeBlocks = [];
            
            while ((match = codeBlockRegex.exec(text)) !== null) {
                const [fullMatch, language, code] = match;
                const blockId = `code-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                codeBlocks.push({ id: blockId, language: language || 'text', code: code.trim() });
                newContent = newContent.replace(fullMatch, `[CODE_BLOCK:${blockId}]`);
            }
            
            // Se encontrou blocos de c√≥digo, process√°-los
            if (codeBlocks.length > 0) {
                element.innerHTML = newContent;
                
                // Substituir placeholders por blocos de c√≥digo reais
                codeBlocks.forEach(({ id, language, code }) => {
                    const placeholderRegex = new RegExp(`\\[CODE_BLOCK:${id}\\]`, 'g');
                    const placeholderMatches = element.innerHTML.match(placeholderRegex);
                    
                    if (placeholderMatches) {
                        const pre = document.createElement("pre");
                        pre.className = "code-block";
                        
                        // Adicionar indicador de linguagem
                        if (language && language !== 'text') {
                            const langSpan = document.createElement("span");
                            langSpan.style.cssText = "display:block; color:#888; font-size:12px; margin-bottom:5px; padding-bottom:5px; border-bottom:1px solid #333;";
                            langSpan.textContent = `üìù ${language}`;
                            pre.appendChild(langSpan);
                        }
                        
                        const codeElement = document.createElement("code");
                        codeElement.textContent = code;
                        pre.appendChild(codeElement);
                        
                        // Substituir todos os placeholders iguais
                        element.innerHTML = element.innerHTML.replace(
                            new RegExp(`\\[CODE_BLOCK:${id}\\]`, 'g'), 
                            pre.outerHTML
                        );
                    }
                });
            }
        }

        // Chamar API Groq com streaming
        async function callGroqAPI(prompt, onChunk, onComplete) {
            const apiKey = apiKeyInput.value.trim();
            const model = modelSelect.value;
            
            if (!apiKey) {
                throw new Error("Por favor, insira sua chave API Groq (gsk_...)");
            }
            
            // Configura√ß√£o baseada no seu exemplo Python
            const requestBody = {
                model: model,
                messages: [
                    {
                        role: "system",
                        content: `Voc√™ √© um assistente especializado em programa√ß√£o. 
                        Gere c√≥digo limpo, bem documentado e funcional.
                        Use markdown com blocos de c√≥digo (```linguagem) para formatar.
                        Inclua coment√°rios explicativos e dicas de uso.
                        Seja direto e t√©cnico, focando na solu√ß√£o pr√°tica.
                        Responda em portugu√™s brasileiro.`
                    },
                    { role: "user", content: prompt }
                ],
                temperature: 0.6,
                max_tokens: 4096,
                top_p: 0.95,
                stream: true,
                stop: null
            };

            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${apiKey}`
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    let errorMessage;
                    try {
                        const errorData = JSON.parse(errorText);
                        errorMessage = errorData.error?.message || errorText;
                    } catch {
                        errorMessage = errorText;
                    }
                    throw new Error(`Erro ${response.status}: ${errorMessage}`);
                }

                // Processar streaming
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let fullResponse = "";
                
                // Adicionar mensagem inicial para streaming
                const messageElement = addMessage("‚ñå", "ai", true);
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ') && line !== 'data: [DONE]') {
                            try {
                                const data = JSON.parse(line.substring(6));
                                const content = data.choices[0]?.delta?.content || '';
                                
                                if (content) {
                                    fullResponse += content;
                                    
                                    // Atualizar mensagem em tempo real
                                    const contentDiv = messageElement.querySelector('.streaming-content');
                                    if (contentDiv) {
                                        contentDiv.textContent = fullResponse + "‚ñå";
                                        messagesDiv.scrollTop = messagesDiv.scrollHeight;
                                    }
                                    
                                    // Chamar callback do chunk
                                    if (onChunk) onChunk(content);
                                }
                            } catch (e) {
                                console.warn("Erro ao processar chunk:", e, line);
                            }
                        }
                    }
                }
                
                // Remover cursor piscando e processar blocos de c√≥digo
                const contentDiv = messageElement.querySelector('.streaming-content');
                if (contentDiv) {
                    contentDiv.textContent = fullResponse;
                    contentDiv.className = "";
                    processCodeBlocks(contentDiv);
                }
                
                if (onComplete) onComplete(fullResponse);
                return fullResponse;
                
            } catch (error) {
                console.error("Erro na API:", error);
                throw error;
            }
        }

        // Event Listeners
        apiKeyInput.addEventListener('input', () => {
            saveConfig();
            updateUI();
        });

        modelSelect.addEventListener('change', () => {
            saveConfig();
            updateUI();
            
            // Adicionar mensagem informativa
            addMessage(`Modelo alterado para: ${modelSelect.options[modelSelect.selectedIndex].text}`, "ai");
        });

        // Enviar mensagem
        sendBtn.addEventListener("click", async () => {
            const text = userInput.value.trim();
            if (!text) {
                userInput.focus();
                return;
            }

            // Adicionar mensagem do usu√°rio
            addMessage(text, "user");
            userInput.value = "";
            
            // Desabilitar bot√£o e mostrar loading
            sendBtn.disabled = true;
            sendBtn.textContent = "Gerando...";

            try {
                // Chamar API Groq com streaming
                await callGroqAPI(text, 
                    // On chunk (streaming)
                    (chunk) => {
                        console.log("Chunk recebido:", chunk);
                    },
                    // On complete
                    (fullResponse) => {
                        console.log("Resposta completa:", fullResponse);
                    }
                );
                
            } catch (error) {
                console.error("Erro completo:", error);
                
                // Mensagem de erro detalhada
                let errorMsg = `‚ùå Erro ao gerar script:\n\n${error.message || error}`;
                
                // Dicas espec√≠ficas para Groq
                if (error.message.includes("401") || error.message.includes("403")) {
                    errorMsg += "\n\nüîë Problema de autentica√ß√£o no Groq:";
                    errorMsg += "\n1. Verifique se copiou a chave corretamente (come√ßa com gsk_)";
                    errorMsg += "\n2. Acesse console.groq.com para verificar sua chave";
                    errorMsg += "\n3. Talvez sua chave expirou ou foi revogada";
                } else if (error.message.includes("429")) {
                    errorMsg += "\n\n‚è∞ Limite de taxa excedido no Groq:";
                    errorMsg += "\n- Espere alguns segundos antes de tentar novamente";
                    errorMsg += "\n- O Groq tem limites por minuto/hora";
                } else if (error.message.includes("model_not_found")) {
                    errorMsg += "\n\nü§ñ Modelo n√£o encontrado:";
                    errorMsg += "\n- Verifique se o nome do modelo est√° correto";
                    errorMsg += "\n- Tente usar 'qwen/qwen3-32b' ou 'llama-3.1-8b-instant'";
                } else if (error.message.includes("Failed to fetch")) {
                    errorMsg += "\n\nüåê Problema de conex√£o:";
                    errorMsg += "\n- Verifique sua conex√£o com a internet";
                    errorMsg += "\n- O Groq pode estar temporariamente indispon√≠vel";
                }
                
                addMessage(errorMsg, "ai");
                
            } finally {
                // Reabilitar bot√£o
                sendBtn.disabled = false;
                sendBtn.textContent = "Gerar Script";
                userInput.focus();
                updateUI();
            }
        });

        // Enviar com Enter (sem Shift)
        userInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter" && !e.shiftKey) {
                e.preventDefault();
                if (!sendBtn.disabled) {
                    sendBtn.click();
                }
            }
        });

        // Auto-resize textarea
        userInput.addEventListener("input", function() {
            this.style.height = "auto";
            this.style.height = Math.min(this.scrollHeight, 200) + "px";
        });

        // Inicializar
        window.addEventListener("load", () => {
            loadConfig();
            userInput.focus();
            
            // Adicionar mensagem de boas-vindas
            const welcomeMsg = `üöÄ Bem-vindo ao Gerador de Scripts com Groq API!

Para come√ßar:
1. Obtenha uma chave API GRATUITA em: console.groq.com
2. Copie a chave (come√ßa com gsk_)
3. Cole no campo acima
4. Escolha o modelo (recomendo qwen/qwen3-32b)
5. Descreva seu script!

Exemplos para testar:
‚Ä¢ "Crie um script Python para converter PDF para TXT"
‚Ä¢ "JavaScript para um cron√¥metro com pausa e reset"
‚Ä¢ "HTML/CSS para um menu dropdown responsivo"

üì¢ O Groq √© gratuito para uso inicial!`;
            
            addMessage(welcomeMsg, "ai");
        });
    </script>
</body>
</html>
